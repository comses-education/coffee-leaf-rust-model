Bootstrap: docker
From: comses/osg-julia:1.7.3
Stage: spython-base

%files
minimal/. /code

%post

# julia -e 'cd("/code"); import Pkg; Pkg.activate("."); println(DEPOT_PATH); println(Base.load_path()); Pkg.add("JSON"); using JSON; println(pathof(JSON))'
# 
# julia --project=/code -e 'import Pkg; println(DEPOT_PATH); println(Base.load_path()); Pkg.add("JSON"); using JSON; println(pathof(JSON))'
# 
# chmod -R a+rX  /root/.julia/

# from https://github.com/Crown421/Singularity.jl/blob/master/src/generate.jl
export JULIA_DEPOT_PATH=/user/.julia

cd /code
julia /code/install.jl
chmod -R a+rX $JULIA_DEPOT_PATH /code
julia --project=/code -e 'import Pkg; println(DEPOT_PATH); println(Base.load_path()); using CSV; println(pathof(CSV))'



cd /code
julia /code/install.jl


# %environment
# export JULIA_LOAD_PATH=:/code
# export JULIA_DEPOT_PATH=:/code

%runscript
# ls /code
cd /code && exec julia "$@"