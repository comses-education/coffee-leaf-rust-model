Bootstrap: docker
From: comses/osg-julia:1.7.3
Stage: spython-base

%files
minimal/. /code

%post

# julia -e 'cd("/code"); import Pkg; Pkg.activate("."); println(DEPOT_PATH); println(Base.load_path()); Pkg.add("JSON"); using JSON; println(pathof(JSON))'
# 
# julia --project=/code -e 'import Pkg; println(DEPOT_PATH); println(Base.load_path()); Pkg.add("JSON"); using JSON; println(pathof(JSON))'
# 
# chmod -R a+rX  /root/.julia/

# ls /code
cd /code
julia /code/install.jl
chmod -R a+rX /root/.julia
julia --project=/code -e 'import Pkg; println(DEPOT_PATH); println(Base.load_path()); using CSV; println(pathof(CSV))'
ls /root/.julia
ls /root/.julia/environments

# %environment
# export JULIA_LOAD_PATH=:/code
# export JULIA_DEPOT_PATH=:/code

%runscript
# ls /code
cd /code && exec /opt/julia/bin/julia "$@"